var app=angular.module("membrosRecord",["ngMessages","ngSanitize","ui.mask","remoteValidation","ngResource","comum","ngTagsInput","ui.bootstrap"]).config(["$interpolateProvider",function(e){e.startSymbol("<%"),e.endSymbol("%>")}]);app.controller("membrosIndexController",["$scope","$http","$resource",function(e,o,a){e.carregando=!0,e.membros=[];a("/regioes");o.get("/membro").then(function(o){e.membros=o.data,e.carregando=!1}),e.userShowLink=function(e){return window.location.origin+"/membro/"+e+"/edit"},e.avatarPathSmall=function(e,o){return null===e?"F"==o?window.location.origin+"/img/membro/000-default-mulher-70px.jpg":window.location.origin+"/img/membro/000-default-homem-70px.jpg":window.location.origin+"/"+e},e.ordenarPor=function(o){e.criterioDeOrdenacao=o,e.direcaoDaOrdenacao=!e.direcaoDaOrdenacao},e.filtroRegioes=function(e){return function(o){if(void 0===e||0==e.length)return!0;for(var a=e.length;a--;)if(e[a].nome===o.regiao)return!0;return!1}},e.filtroGrupos=function(e){return function(o){if(void 0===e||0==e.length)return!0;for(var a=e.length;a--;)if(e[a].id===o.grupo_caseiro_id)return!0;return!1}},e.loadRegioesTags=function(e){return o.get("/regioes",{cache:!0}).then(function(o){return o.data.filter(function(o){return-1!=o.nome.toLowerCase().indexOf(e.toLowerCase())})})},e.loadGruposTags=function(e){return o.get("/membro/grupo-caseiro/lista",{cache:!0}).then(function(o){return o.data.filter(function(o){return-1!=o.nome.toLowerCase().indexOf(e.toLowerCase())})})},e.validarTag=function(e){return void 0!==e.id}}]),app.controller("membroCreateCtrl",["$scope","$http","$location",function(e,o,a){this.focus=!1,e.button="Cadastrar Membro",e.edit=!1,o.get("/membro/grupo-caseiro/lista").then(function(o){e.grupos=o.data}),o.get("/regioes").then(function(o){e.regioes=o.data}),e.membro={},e.membro.avatar_path="/img/membro/000-default-homem-70px.jpg",e.dateOptions={dateDisabled:!1,formatYear:"yyyy",showWeeks:!1,maxDate:new Date,startingDay:1}}]),app.controller("membroEditCtrl",["$scope","$http","$location",function(e,o,a){e.button="Atualizar Membro",e.edit=!0,e.loadingRelFamilia=!1,o.get("/membro/grupo-caseiro/lista").then(function(o){e.grupos=o.data}),o.get("/regioes").then(function(o){e.regioes=o.data}),e.atualizaRelsIgreja=function(){o.get("/membro/"+post.id+"/relacionamentos/igreja").then(function(o){e.relacionamentosIgreja=o.data})},e.atualizaRelsIgreja(),e.atualizaRelsFamilia=function(){o.get("/membro/"+post.id+"/relacionamentos/familia").then(function(o){e.relacionamentosFamilia=o.data})},e.atualizaRelsFamilia(),o.get("/membros/relacionamentos/familia").then(function(o){e.listaRelacionamentosFamilia=o.data}),o.get("/membros/relacionamentos/igreja").then(function(o){e.listaRelacionamentosIgreja=o.data}),e.userShowLink=function(e){return window.location.origin+"/membro/"+e+"/edit"},e.membro={},e.membro.nome=post.nome,e.membro.id=post.id,e.membro.grupo=post.grupo,e.gci=9,e.membro.sexo=post.sexo;var t=moment(post.data_nascimento,"Y-MM-DD").format("D/M/YYYY");e.membro.data_nascimento=t;var n=post.avatar_path;e.membro.avatar_path=null==n?"M"==e.membro.sexo?"/img/membro/000-default-homem-70px.jpg":"/img/membro/000-default-mulher-70px.jpg":"/"+post.avatar_path,e.membro.regiao=post.regiao,e.membro.endereco=post.endereco,e.membro.email=post.email,e.membro.telefones=post.telefones_json,e.add_tipo_relacionamento;var r;e.getMembrosRelacionamento=function(e){return console.log("---"),o.get("/membro",{cache:!0}).then(function(o){return r=o.data,r.filter(function(o){var a=function(e){return e.replace(/á/g,"a").replace(/ã/g,"a").replace(/â/g,"a").replace(/ç/g,"c").replace(/é/g,"e").replace(/ẽ/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/õ/g,"o").replace(/ú/g,"u")},t=a(o.nome.toLowerCase()),n=a(e.toLowerCase());return-1!=t.indexOf(n)})},function(e){console.log(e.data),toastr.error("Falha na requisição")})},e.formatInput=function(e){var o="";return angular.forEach(r,function(a){e===a.id&&(o=a.nome)}),o},e.erros_add_relacionamento=[],e.actAddRelacionamento=function(a,t,n){toastr.options={positionClass:"toast-bottom-right"};var r={};r.relacionamento=t,r.membroDestino=n,o({method:"POST",url:"/membro/"+a+"/relacionamento/add",data:r}).then(function(o){o.data.erros?o.data.erros.forEach(function(e){toastr.warning(e).css("width","500px")}):(e.atualizaRelsFamilia(),e.atualizaRelsIgreja(),toastr.success("Relacionamento incluído com sucesso"))},function(e){console.log(e.data),toastr.error("Falha na requisição")})},e.actRemoveRelacionamento=function(a,t){console.log(t);var n={};n.rel_id=t,n.membro=a,o({method:"POST",url:"/membro/remover-relacionamento",data:n}).then(function(o){e.atualizaRelsFamilia(),e.atualizaRelsIgreja(),toastr.options={positionClass:"toast-bottom-right"},toastr.success("Relacionamento excluído")},function(e){console.log(e.data),console.log("Falha na requisição")})}}]),$(function(){$(document.body).on("click",".changeType",function(){$(this).closest(".phone-input").find(".type-text").text($(this).text()),$(this).closest(".phone-input").find(".type-input").val($(this).data("type-value"))}),$(document.body).on("click",".btn-remove-phone",function(){$(this).closest(".phone-input").remove()}),$(".btn-add-phone").click(function(){var e=$(".phone-input").length+1;$(".phone-list").append('<div class="input-group phone-input"><span class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span class="type-text">Tipo:</span> <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><a class="changeType" href="javascript:;" data-type-value="celular">Celular</a></li><li><a class="changeType" href="javascript:;" data-type-value="residencial">Residencial</a></li><li><a class="changeType" href="javascript:;" data-type-value="comercial">Comercial</a></li></ul></span><input type="text" name="telefone['+e+'][numero]" class="form-control" placeholder="99999 9999" /><input type="hidden" name="telefone['+e+'][tipo]" class="type-input" value="" /><span class="input-group-btn"><button class="btn btn-danger btn-remove-phone" type="button"><i class="fa fa-trash-o" aria-hidden="true"></i></button></span></div>')})});