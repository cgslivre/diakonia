var app = angular.module('usuariosRecord', ['ngMessages','ngSanitize','ui.mask','remoteValidation'])
  .config(['$interpolateProvider', function ($interpolateProvider) {
      $interpolateProvider.startSymbol('<%');
      $interpolateProvider.endSymbol('%>');
}]);

var compareTo = function() {
    return {
        require: "ngModel",
        scope: {
            otherModelValue: "=compareTo"
        },
        link: function(scope, element, attributes, ngModel) {

            ngModel.$validators.compareTo = function(modelValue) {
                return modelValue == scope.otherModelValue;
            };

            scope.$watch("otherModelValue", function() {
                ngModel.$validate();
            });
        }
    };
};

app.directive("compareTo", compareTo);

app.controller('usuariosController', ['$scope', '$http',
  function ($scope, $http) {
    $scope.usuarios = [];
    $http.get("/usuario").success(function(data) {

        $scope.usuarios = data;
        //console.log($scope.usuarios[1].usuario_roles.length);
    });
    $scope.avatarPathSmall = function( avatar ){
        if ( avatar === null ){
            return window.location.origin + '/users/avatar/000-default-70px.jpg';
        } else{
            return window.location.origin  + '/' + avatar + '70px.jpg';
        }
	};

    $scope.userEditLink = function( user ){
        return window.location.origin + '/usuario/' + user + '/edit';
	};

    $scope.userShowLink = function( user ){
        return window.location.origin + '/usuario/' + user;
	};

    $scope.userShowPermissionLink = function( user ){
        return window.location.origin + '/usuario/' + user + '/permissoes';
	};

    $scope.ordenarPor = function( campo ){
		$scope.criterioDeOrdenacao = campo;
		$scope.direcaoDaOrdenacao = !$scope.direcaoDaOrdenacao;
	};

}]);

app.filter('highlight', ['$sce', function($sce) {
    return function(text, phrase) {

        if( phrase ){
            text = text.replace(new RegExp('('+phrase+')', 'gi'), '<span class="highlighted">$1</span>');
        }
        return $sce.trustAsHtml(text);
    };
}]);

app.filter('formatPhone', ['$sce', function($sce) {
    return function(input) {
        console.log('>> ' + input);
        if( input == null || input.length == 0 ){
            return '';
        } else{
            switch (input.length) {
                case 8:
                    return input.slice(0,4) + '-' + input.slice(4,8);
                case 9:
                    return input.slice(0,5) + '-' + input.slice(5,9);
                case 10:
                    return '(' + input.slice(0,2) + ') ' + input.slice(2,6) + '-' + input.slice(6,10);
                case 11:
                    return '(' + input.slice(0,2) + ') ' + input.slice(2,7) + '-' + input.slice(7,11);
                default:
                    return input;
            }
        }
    };
}]);

app.filter('roleuserfilter', ['$sce', function($sce) {
    return function(input) {
        if( input === 'role-user-admin') return 'Administrador';
        else if( input === 'role-user-manage') return 'Gerente';
        else if( input === 'role-user-users') return 'Padrão';
        else return input;
    };
}]);


function mascaraTelefone( input ){
    if( input == null || input.length == 0 ){
        return '';
    } else{
        switch (input.length) {
            case 8:
                return input.slice(0,4) + '-' + input.slice(4,8);
            case 9:
                return input.slice(0,5) + '-' + input.slice(5,9);
            case 10:
                return '(' + input.slice(0,2) + ') ' + input.slice(2,6) + '-' + input.slice(6,10);
            case 11:
                return '(' + input.slice(0,2) + ') ' + input.slice(2,7) + '-' + input.slice(7,11);
            default:
                return input;
        }
    }
}

app.controller('userCreateCtrl', ['$scope', '$http', '$location',
  function ($scope, $http,$location) {
    $scope.button = "Criar Usuário";
    $scope.emailField = true;

  }
]);

app.controller('userEditCtrl', ['$scope', '$http', '$location',
  function ($scope, $http,$location) {
    $scope.button = "Atualizar Usuário";
    $scope.emailField = false;
    //console.log(post['name']);
    $scope.usuario = {};
    $scope.usuario.name = post['name'];
    $scope.usuario.email = post['email'];
    $scope.usuario.telefone = post['telefone'];
  }
]);

//# sourceMappingURL=app-users-module.min.js.map
